- hosts: all
  vars:
    composer_settings: "{{ lookup('file','../app/api/composer.json') | from_json }}"
  roles:
    - { role: 'repo-epel', tags: ["build","deploy"] }
    - { role: 'repo-remi', tags: ["build","deploy"] }
    - { role: 'nodejs', tags: ["build"] }
    - { role: 'php_upgrade', tags: ["build","deploy"] }
    - { role: 'git', tags: ["build"] }
    - { role: 'composer', tags: ["build"] }
  tasks:
    - name: Enable php-56 and update
      yum:
        name: "php"
        enablerepo: remi-php56
        state: latest   
      tags:
        - build
        - deploy
    - name: Add phar.readonly to php.ini
      ini_file:
        dest: /etc/php.ini
        section: Phar
        option: phar.readonly
        value: Off
      tags:
        - build
        - deploy
    - name: Update composer dependencies for Security Awareness Exam
      composer:
        command: "{{ item }}"
        working_dir: "/vagrant/app/api"
      become: yes
      become_user: "{{ remote_user }}"   
      with_items:
        - install
        - update

